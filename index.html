<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MLB Front Office Roguelike</title>
  <style>
    :root {
      color-scheme: light;
      --bg: #f7f7f5;
      --panel: #ffffff;
      --border: #e2e2e2;
      --text: #111111;
      --muted: #5f6368;
      --accent: #1d3557;
      --accent-2: #457b9d;
      --success: #2d6a4f;
      --danger: #c1121f;
      --shadow: 0 12px 28px rgba(0, 0, 0, 0.08);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: "Inter", "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
    }

    .app {
      max-width: 1280px;
      margin: 0 auto;
      padding: 28px 20px 60px;
    }

    header {
      display: flex;
      align-items: flex-end;
      justify-content: space-between;
      margin-bottom: 24px;
      gap: 20px;
      flex-wrap: wrap;
    }

    .title {
      font-size: 2rem;
      font-weight: 700;
      letter-spacing: 0.02em;
    }

    .subtitle {
      color: var(--muted);
      font-size: 0.95rem;
      margin-top: 8px;
      max-width: 520px;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: var(--panel);
      color: var(--muted);
      font-size: 0.8rem;
    }

    .menu {
      display: grid;
      place-items: center;
      min-height: 70vh;
    }

    .menu-card {
      background: var(--panel);
      padding: 32px;
      border-radius: 20px;
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
      max-width: 520px;
      width: 100%;
    }

    .menu-card h1 {
      font-size: 1.8rem;
      margin-bottom: 12px;
    }

    .menu-card p {
      color: var(--muted);
      line-height: 1.6;
      margin-bottom: 20px;
    }

    .menu-card select {
      width: 100%;
      padding: 12px;
      border-radius: 10px;
      border: 1px solid var(--border);
      margin-bottom: 16px;
      font-size: 0.95rem;
    }

    .menu-actions {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    button {
      border: none;
      border-radius: 10px;
      padding: 12px 18px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    button.primary {
      background: var(--accent);
      color: #fff;
    }

    button.secondary {
      background: var(--panel);
      border: 1px solid var(--border);
      color: var(--text);
    }

    button.ghost {
      background: transparent;
      color: var(--muted);
    }

    button:disabled {
      cursor: not-allowed;
      opacity: 0.5;
      box-shadow: none;
    }

    button:hover:not(:disabled) {
      transform: translateY(-1px);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
    }

    .layout {
      display: grid;
      grid-template-columns: 1fr 1.4fr 1fr;
      gap: 18px;
    }

    .panel {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 18px;
      padding: 18px;
      box-shadow: var(--shadow);
      display: grid;
      gap: 14px;
    }

    .panel h3 {
      font-size: 1rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--accent);
    }

    .stat-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px;
    }

    .stat {
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 10px;
      background: #fbfbfb;
    }

    .stat span {
      display: block;
      font-size: 0.8rem;
      color: var(--muted);
    }

    .stat strong {
      font-size: 1.1rem;
    }

    .series-list,
    .roster-list,
    .decision-list {
      display: grid;
      gap: 10px;
    }

    .card {
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 12px;
      background: #fff;
      cursor: pointer;
      transition: border 0.2s ease, transform 0.2s ease;
    }

    .card:hover {
      border-color: var(--accent-2);
      transform: translateY(-1px);
    }

    .card.active {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px var(--accent);
    }

    .card h4 {
      font-size: 0.95rem;
      margin-bottom: 6px;
    }

    .card small {
      color: var(--muted);
    }

    .tag-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .tag {
      border-radius: 999px;
      padding: 4px 10px;
      font-size: 0.75rem;
      background: #f1f3f5;
      color: var(--muted);
    }

    .log {
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 12px;
      background: #fafafa;
      max-height: 240px;
      overflow-y: auto;
      display: grid;
      gap: 8px;
      font-size: 0.88rem;
    }

    .log-entry.good { color: var(--success); }
    .log-entry.bad { color: var(--danger); }

    .bar {
      height: 6px;
      background: #eaeaea;
      border-radius: 999px;
      overflow: hidden;
      margin-top: 6px;
    }

    .bar span {
      display: block;
      height: 100%;
      background: var(--accent-2);
    }

    .actions {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .matchup {
      display: grid;
      gap: 10px;
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 14px;
      background: #fbfbfb;
    }

    .matchup h2 {
      font-size: 1.2rem;
    }

    .scoreboard {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 12px;
    }

    .score {
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 10px;
      text-align: center;
    }

    @media (max-width: 1100px) {
      .layout {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div>
        <div class="title">MLB Front Office Roguelike</div>
        <div class="subtitle">Pick a real MLB club, plan series strategy, and balance fatigue, payroll, and momentum across a 12-series season.</div>
      </div>
      <div class="tag-row" id="headerPills"></div>
    </header>

    <section class="menu" id="menu">
      <div class="menu-card">
        <h1>Start Your Run</h1>
        <p>Select a current MLB team and guide them through a 12-series sprint to October.</p>
        <label for="teamSelect" class="pill">Choose Team</label>
        <select id="teamSelect"></select>
        <div class="menu-actions">
          <button class="primary" id="startBtn">Start Season</button>
          <button class="secondary" id="continueBtn" disabled>Continue Save</button>
          <button class="ghost" id="resetBtn">Reset Save</button>
        </div>
      </div>
    </section>

    <section id="game" style="display: none;">
      <div class="layout">
        <div class="panel">
          <h3>Front Office</h3>
          <div class="stat-grid" id="statGrid"></div>
          <div class="decision-list" id="decisionList"></div>
          <div class="actions">
            <button class="secondary" id="scoutBtn">Scout New Series (-$2,500)</button>
            <button class="ghost" id="saveBtn">Save & Exit</button>
          </div>
        </div>

        <div class="panel">
          <h3>Series Hub</h3>
          <div class="matchup" id="matchupCard"></div>
          <div class="series-list" id="seriesList"></div>
          <div class="actions">
            <button class="primary" id="playBtn">Play Game</button>
            <button class="secondary" id="restBtn">Recovery Day</button>
            <button class="ghost" id="boostBtn">Clubhouse Meeting</button>
          </div>
          <div class="log" id="log"></div>
        </div>

        <div class="panel">
          <h3>Roster</h3>
          <div class="roster-list" id="rosterList"></div>
          <div class="actions">
            <button class="secondary" id="trainingBtn">Hitting Lab ($4,000)</button>
            <button class="secondary" id="pitchingBtn">Pitch Lab ($4,000)</button>
          </div>
        </div>
      </div>
    </section>
  </div>

  <script>
    const teams = [
      { name: "Arizona Diamondbacks", abbr: "ARI", rating: 78 },
      { name: "Atlanta Braves", abbr: "ATL", rating: 88 },
      { name: "Baltimore Orioles", abbr: "BAL", rating: 84 },
      { name: "Boston Red Sox", abbr: "BOS", rating: 80 },
      { name: "Chicago Cubs", abbr: "CHC", rating: 79 },
      { name: "Chicago White Sox", abbr: "CWS", rating: 74 },
      { name: "Cincinnati Reds", abbr: "CIN", rating: 77 },
      { name: "Cleveland Guardians", abbr: "CLE", rating: 82 },
      { name: "Colorado Rockies", abbr: "COL", rating: 73 },
      { name: "Detroit Tigers", abbr: "DET", rating: 76 },
      { name: "Houston Astros", abbr: "HOU", rating: 86 },
      { name: "Kansas City Royals", abbr: "KC", rating: 75 },
      { name: "Los Angeles Angels", abbr: "LAA", rating: 74 },
      { name: "Los Angeles Dodgers", abbr: "LAD", rating: 90 },
      { name: "Miami Marlins", abbr: "MIA", rating: 72 },
      { name: "Milwaukee Brewers", abbr: "MIL", rating: 81 },
      { name: "Minnesota Twins", abbr: "MIN", rating: 80 },
      { name: "New York Mets", abbr: "NYM", rating: 79 },
      { name: "New York Yankees", abbr: "NYY", rating: 85 },
      { name: "Oakland Athletics", abbr: "OAK", rating: 70 },
      { name: "Philadelphia Phillies", abbr: "PHI", rating: 85 },
      { name: "Pittsburgh Pirates", abbr: "PIT", rating: 75 },
      { name: "San Diego Padres", abbr: "SD", rating: 82 },
      { name: "San Francisco Giants", abbr: "SF", rating: 78 },
      { name: "Seattle Mariners", abbr: "SEA", rating: 83 },
      { name: "St. Louis Cardinals", abbr: "STL", rating: 79 },
      { name: "Tampa Bay Rays", abbr: "TB", rating: 83 },
      { name: "Texas Rangers", abbr: "TEX", rating: 84 },
      { name: "Toronto Blue Jays", abbr: "TOR", rating: 82 },
      { name: "Washington Nationals", abbr: "WSH", rating: 72 }
    ];

    const playerPool = [
      { name: "Ronald Acuna Jr.", team: "ATL", role: "OF", bat: 94, pow: 92, pit: 35, def: 86, spd: 92 },
      { name: "Matt Olson", team: "ATL", role: "1B", bat: 88, pow: 92, pit: 30, def: 80, spd: 55 },
      { name: "Spencer Strider", team: "ATL", role: "SP", bat: 20, pow: 15, pit: 94, def: 72, spd: 60 },
      { name: "Mookie Betts", team: "LAD", role: "OF", bat: 92, pow: 88, pit: 35, def: 88, spd: 82 },
      { name: "Freddie Freeman", team: "LAD", role: "1B", bat: 90, pow: 86, pit: 30, def: 82, spd: 55 },
      { name: "Shohei Ohtani", team: "LAD", role: "DH", bat: 94, pow: 95, pit: 90, def: 70, spd: 78 },
      { name: "Aaron Judge", team: "NYY", role: "OF", bat: 92, pow: 96, pit: 40, def: 82, spd: 68 },
      { name: "Gerrit Cole", team: "NYY", role: "SP", bat: 20, pow: 15, pit: 92, def: 70, spd: 55 },
      { name: "Juan Soto", team: "NYY", role: "OF", bat: 93, pow: 92, pit: 30, def: 75, spd: 68 },
      { name: "Yordan Alvarez", team: "HOU", role: "OF", bat: 92, pow: 95, pit: 25, def: 72, spd: 60 },
      { name: "Jose Altuve", team: "HOU", role: "2B", bat: 90, pow: 78, pit: 30, def: 80, spd: 78 },
      { name: "Framber Valdez", team: "HOU", role: "SP", bat: 25, pow: 15, pit: 89, def: 74, spd: 55 },
      { name: "Bryce Harper", team: "PHI", role: "1B", bat: 90, pow: 92, pit: 30, def: 78, spd: 70 },
      { name: "Trea Turner", team: "PHI", role: "SS", bat: 88, pow: 82, pit: 30, def: 82, spd: 92 },
      { name: "Zack Wheeler", team: "PHI", role: "SP", bat: 25, pow: 15, pit: 90, def: 72, spd: 60 },
      { name: "Julio Rodriguez", team: "SEA", role: "OF", bat: 88, pow: 86, pit: 30, def: 84, spd: 86 },
      { name: "Luis Castillo", team: "SEA", role: "SP", bat: 25, pow: 15, pit: 88, def: 74, spd: 55 },
      { name: "Cal Raleigh", team: "SEA", role: "C", bat: 82, pow: 86, pit: 20, def: 84, spd: 45 },
      { name: "Corey Seager", team: "TEX", role: "SS", bat: 91, pow: 89, pit: 30, def: 78, spd: 60 },
      { name: "Marcus Semien", team: "TEX", role: "2B", bat: 86, pow: 84, pit: 30, def: 82, spd: 70 },
      { name: "Jacob deGrom", team: "TEX", role: "SP", bat: 20, pow: 15, pit: 93, def: 74, spd: 60 },
      { name: "Jose Ramirez", team: "CLE", role: "3B", bat: 90, pow: 88, pit: 30, def: 82, spd: 80 },
      { name: "Emmanuel Clase", team: "CLE", role: "RP", bat: 15, pow: 10, pit: 91, def: 70, spd: 50 },
      { name: "Shane Bieber", team: "CLE", role: "SP", bat: 20, pow: 15, pit: 86, def: 72, spd: 55 },
      { name: "Bobby Witt Jr.", team: "KC", role: "SS", bat: 88, pow: 85, pit: 30, def: 80, spd: 92 },
      { name: "Salvador Perez", team: "KC", role: "C", bat: 84, pow: 88, pit: 20, def: 78, spd: 45 },
      { name: "Cole Ragans", team: "KC", role: "SP", bat: 20, pow: 15, pit: 85, def: 72, spd: 55 },
      { name: "Gunnar Henderson", team: "BAL", role: "SS", bat: 89, pow: 87, pit: 30, def: 82, spd: 76 },
      { name: "Adley Rutschman", team: "BAL", role: "C", bat: 86, pow: 82, pit: 20, def: 86, spd: 50 },
      { name: "Corbin Burnes", team: "BAL", role: "SP", bat: 20, pow: 15, pit: 92, def: 74, spd: 55 },
      { name: "Paul Skenes", team: "PIT", role: "SP", bat: 20, pow: 15, pit: 88, def: 72, spd: 60 },
      { name: "Bryan Reynolds", team: "PIT", role: "OF", bat: 84, pow: 82, pit: 25, def: 80, spd: 70 },
      { name: "Oneil Cruz", team: "PIT", role: "SS", bat: 82, pow: 88, pit: 30, def: 78, spd: 86 },
      { name: "Ketel Marte", team: "ARI", role: "2B", bat: 86, pow: 84, pit: 30, def: 80, spd: 72 },
      { name: "Corbin Carroll", team: "ARI", role: "OF", bat: 88, pow: 82, pit: 25, def: 82, spd: 92 },
      { name: "Zac Gallen", team: "ARI", role: "SP", bat: 20, pow: 15, pit: 88, def: 72, spd: 55 },
      { name: "Vladimir Guerrero Jr.", team: "TOR", role: "1B", bat: 88, pow: 90, pit: 30, def: 76, spd: 55 },
      { name: "Bo Bichette", team: "TOR", role: "SS", bat: 86, pow: 84, pit: 30, def: 78, spd: 70 },
      { name: "Kevin Gausman", team: "TOR", role: "SP", bat: 20, pow: 15, pit: 87, def: 70, spd: 55 },
      { name: "Rafael Devers", team: "BOS", role: "3B", bat: 88, pow: 90, pit: 30, def: 74, spd: 55 },
      { name: "Triston Casas", team: "BOS", role: "1B", bat: 82, pow: 86, pit: 25, def: 78, spd: 50 },
      { name: "Brayan Bello", team: "BOS", role: "SP", bat: 20, pow: 15, pit: 83, def: 70, spd: 55 },
      { name: "Mike Trout", team: "LAA", role: "OF", bat: 90, pow: 90, pit: 30, def: 82, spd: 78 },
      { name: "Zach Neto", team: "LAA", role: "SS", bat: 80, pow: 76, pit: 25, def: 78, spd: 70 },
      { name: "Patrick Sandoval", team: "LAA", role: "SP", bat: 20, pow: 15, pit: 82, def: 72, spd: 55 },
      { name: "Fernando Tatis Jr.", team: "SD", role: "OF", bat: 90, pow: 90, pit: 35, def: 86, spd: 90 },
      { name: "Manny Machado", team: "SD", role: "3B", bat: 88, pow: 88, pit: 30, def: 84, spd: 68 },
      { name: "Yu Darvish", team: "SD", role: "SP", bat: 20, pow: 15, pit: 84, def: 72, spd: 55 },
      { name: "Logan Webb", team: "SF", role: "SP", bat: 20, pow: 15, pit: 87, def: 74, spd: 55 },
      { name: "Jung Hoo Lee", team: "SF", role: "OF", bat: 82, pow: 72, pit: 25, def: 84, spd: 78 },
      { name: "Matt Chapman", team: "SF", role: "3B", bat: 82, pow: 86, pit: 30, def: 90, spd: 70 }
    ];

    const freeAgents = [
      { name: "Cody Bellinger", role: "OF", bat: 84, pow: 82, pit: 25, def: 84, spd: 78 },
      { name: "Jordan Montgomery", role: "SP", bat: 20, pow: 15, pit: 84, def: 72, spd: 55 },
      { name: "Blake Snell", role: "SP", bat: 20, pow: 15, pit: 90, def: 72, spd: 55 },
      { name: "Josh Hader", role: "RP", bat: 15, pow: 10, pit: 88, def: 70, spd: 50 },
      { name: "Rhys Hoskins", role: "1B", bat: 84, pow: 86, pit: 20, def: 72, spd: 50 }
    ];

    const strategyOptions = [
      {
        name: "Aggressive Offense",
        description: "+Power, +Hype, +Fatigue",
        apply: (state) => {
          state.modifiers.power += 0.12;
          state.hype = Math.min(100, state.hype + 4);
          state.teamFatigue = Math.min(100, state.teamFatigue + 6);
        }
      },
      {
        name: "Pitching First",
        description: "+Pitching, -Hype",
        apply: (state) => {
          state.modifiers.pitching += 0.1;
          state.hype = Math.max(0, state.hype - 2);
        }
      },
      {
        name: "Elite Defense",
        description: "+Defense, +Consistency",
        apply: (state) => {
          state.modifiers.defense += 0.1;
          state.momentum = Math.min(20, state.momentum + 2);
        }
      },
      {
        name: "Pressure on Bases",
        description: "+Speed, +Risk",
        apply: (state) => {
          state.modifiers.speed += 0.1;
          state.risk += 2;
        }
      }
    ];

    const dom = {
      menu: document.getElementById("menu"),
      game: document.getElementById("game"),
      headerPills: document.getElementById("headerPills"),
      teamSelect: document.getElementById("teamSelect"),
      startBtn: document.getElementById("startBtn"),
      continueBtn: document.getElementById("continueBtn"),
      resetBtn: document.getElementById("resetBtn"),
      statGrid: document.getElementById("statGrid"),
      decisionList: document.getElementById("decisionList"),
      seriesList: document.getElementById("seriesList"),
      rosterList: document.getElementById("rosterList"),
      matchupCard: document.getElementById("matchupCard"),
      log: document.getElementById("log"),
      scoutBtn: document.getElementById("scoutBtn"),
      playBtn: document.getElementById("playBtn"),
      restBtn: document.getElementById("restBtn"),
      boostBtn: document.getElementById("boostBtn"),
      trainingBtn: document.getElementById("trainingBtn"),
      pitchingBtn: document.getElementById("pitchingBtn"),
      saveBtn: document.getElementById("saveBtn")
    };

    let state = null;

    const randomInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
    const randomPick = (arr) => arr[randomInt(0, arr.length - 1)];

    const buildRoster = (teamAbbr) => {
      const roster = playerPool.filter((player) => player.team === teamAbbr);
      while (roster.length < 9) {
        roster.push(randomPick(freeAgents));
      }
      return roster.slice(0, 9).map((player) => ({
        ...player,
        fatigue: randomInt(10, 25)
      }));
    };

    const generateSeriesOptions = (teamAbbr) => {
      const options = [];
      const opponents = teams.filter((team) => team.abbr !== teamAbbr);
      for (let i = 0; i < 3; i++) {
        const opponent = randomPick(opponents);
        options.push({
          id: Date.now() + i,
          opponent: opponent.name,
          opponentAbbr: opponent.abbr,
          rating: opponent.rating,
          games: 3,
          wins: 0,
          losses: 0,
          risk: randomInt(4, 12),
          payout: randomInt(3500, 8000),
          momentumSwing: randomInt(2, 6)
        });
      }
      return options;
    };

    const createState = (teamAbbr) => ({
      team: teamAbbr,
      season: 1,
      series: 1,
      wins: 0,
      losses: 0,
      bankroll: 18000,
      hype: 50,
      momentum: 0,
      teamFatigue: 20,
      risk: 0,
      modifiers: { power: 1, contact: 1, pitching: 1, defense: 1, speed: 1 },
      roster: buildRoster(teamAbbr),
      seriesOptions: generateSeriesOptions(teamAbbr),
      activeSeriesId: null,
      strategyIndex: null,
      strategyApplied: false,
      log: ["Season opened. Reach 7 series wins to unlock the postseason."],
      seriesWins: 0
    });

    const saveGame = () => {
      localStorage.setItem("mlbRogueLeague", JSON.stringify(state));
      dom.continueBtn.disabled = false;
    };

    const loadGame = () => {
      const saved = localStorage.getItem("mlbRogueLeague");
      if (!saved) return null;
      return JSON.parse(saved);
    };

    const addLog = (message, tone = "") => {
      state.log.unshift({ message, tone });
      if (state.log.length > 16) state.log.pop();
    };

    const activeSeries = () => state.seriesOptions.find((series) => series.id === state.activeSeriesId);

    const averageStat = (key) => {
      const total = state.roster.reduce((sum, player) => sum + player[key], 0);
      return total / state.roster.length;
    };

    const applyStrategy = () => {
      if (state.strategyIndex === null || state.strategyApplied) return;
      strategyOptions[state.strategyIndex].apply(state);
      state.strategyApplied = true;
    };

    const simulateGame = () => {
      const series = activeSeries();
      if (!series) return;

      const fatigueFactor = (100 - state.teamFatigue) / 100;
      const offense = (averageStat("bat") + averageStat("pow")) / 2 * state.modifiers.power * state.modifiers.contact;
      const defense = averageStat("def") * state.modifiers.defense;
      const pitching = averageStat("pit") * state.modifiers.pitching;
      const speed = averageStat("spd") * state.modifiers.speed;
      const hypeBoost = 1 + state.hype / 200;
      const momentumBoost = 1 + state.momentum / 120;

      const playerRuns = Math.max(0, Math.round((offense / 18 + speed / 120) * fatigueFactor * hypeBoost * momentumBoost + randomInt(0, 3)));
      const opponentRuns = Math.max(0, Math.round((series.rating / 18) * (2 - (pitching + defense) / 190) + randomInt(0, 3)));

      if (playerRuns >= opponentRuns) {
        series.wins += 1;
        state.wins += 1;
        state.momentum = Math.min(25, state.momentum + series.momentumSwing);
        state.hype = Math.min(100, state.hype + 3);
        addLog(`Win ${playerRuns}-${opponentRuns} vs ${series.opponent}.`, "good");
      } else {
        series.losses += 1;
        state.losses += 1;
        state.momentum = Math.max(-20, state.momentum - 4);
        state.hype = Math.max(0, state.hype - 4);
        addLog(`Loss ${playerRuns}-${opponentRuns} vs ${series.opponent}.`, "bad");
      }

      state.teamFatigue = Math.min(100, state.teamFatigue + randomInt(5, 10));

      if (series.wins + series.losses >= series.games || series.wins === 2 || series.losses === 2) {
        resolveSeries(series);
      }
    };

    const resolveSeries = (series) => {
      const wonSeries = series.wins > series.losses;
      if (wonSeries) {
        state.bankroll += series.payout;
        state.seriesWins += 1;
        state.hype = Math.min(100, state.hype + 5);
        addLog(`Series win! Earned $${series.payout}.`, "good");
      } else {
        state.bankroll = Math.max(0, state.bankroll - Math.round(series.payout / 2));
        addLog("Dropped the series. Budget took a hit.", "bad");
      }

      if (randomInt(1, 100) <= series.risk + state.risk) {
        const player = randomPick(state.roster);
        player.fatigue = Math.min(100, player.fatigue + 20);
        addLog(`${player.name} is dealing with soreness.`, "bad");
      }

      state.series += 1;
      state.seriesOptions = generateSeriesOptions(state.team);
      state.activeSeriesId = null;
      state.strategyIndex = null;
      state.strategyApplied = false;
      state.modifiers = { power: 1, contact: 1, pitching: 1, defense: 1, speed: 1 };
      state.risk = 0;

      if (state.series > 12) {
        addLog("Season complete. Reset to run it back.", "good");
      }
    };

    const refreshSeries = () => {
      if (state.bankroll < 2500) {
        addLog("Not enough budget to scout new opponents.", "bad");
        return;
      }
      state.bankroll -= 2500;
      state.seriesOptions = generateSeriesOptions(state.team);
      state.activeSeriesId = null;
      state.strategyIndex = null;
      state.strategyApplied = false;
      addLog("New scouting report arrived.", "good");
    };

    const restDay = () => {
      state.teamFatigue = Math.max(0, state.teamFatigue - 18);
      state.hype = Math.max(0, state.hype - 3);
      addLog("Rest day scheduled. Fatigue drops.", "good");
    };

    const clubhouseMeeting = () => {
      if (state.bankroll < 2000) {
        addLog("Need $2,000 to host the clubhouse meeting.", "bad");
        return;
      }
      state.bankroll -= 2000;
      state.momentum = Math.min(25, state.momentum + 4);
      addLog("Clubhouse unity restored. Momentum climbs.", "good");
    };

    const runTraining = (type) => {
      if (state.bankroll < 4000) {
        addLog("Training budget short.", "bad");
        return;
      }
      state.bankroll -= 4000;
      if (type === "hitting") {
        state.modifiers.contact += 0.08;
        state.modifiers.power += 0.06;
        addLog("Hitting lab boosts bats for the next series.", "good");
      } else {
        state.modifiers.pitching += 0.1;
        state.modifiers.defense += 0.06;
        addLog("Pitch lab sharpens arms and gloves.", "good");
      }
    };

    const renderHeader = () => {
      dom.headerPills.innerHTML = "";
      const team = teams.find((entry) => entry.abbr === state.team);
      const pills = [
        team ? team.name : "",
        `Series ${state.series}/12`,
        `W-L ${state.wins}-${state.losses}`,
        `Series Wins ${state.seriesWins}`
      ];
      pills.filter(Boolean).forEach((text) => {
        const span = document.createElement("span");
        span.className = "pill";
        span.textContent = text;
        dom.headerPills.appendChild(span);
      });
    };

    const renderStats = () => {
      dom.statGrid.innerHTML = "";
      const stats = [
        { label: "Budget", value: `$${state.bankroll.toLocaleString()}` },
        { label: "Fan Hype", value: state.hype },
        { label: "Momentum", value: state.momentum },
        { label: "Team Fatigue", value: state.teamFatigue },
        { label: "Risk", value: state.risk },
        { label: "Series Wins", value: state.seriesWins }
      ];
      stats.forEach((stat) => {
        const card = document.createElement("div");
        card.className = "stat";
        card.innerHTML = `<span>${stat.label}</span><strong>${stat.value}</strong>`;
        dom.statGrid.appendChild(card);
      });
    };

    const renderDecisions = () => {
      dom.decisionList.innerHTML = "";
      strategyOptions.forEach((option, index) => {
        const card = document.createElement("div");
        card.className = "card";
        if (state.strategyIndex === index) {
          card.classList.add("active");
        }
        card.innerHTML = `<h4>${option.name}</h4><small>${option.description}</small>`;
        card.addEventListener("click", () => {
          state.strategyIndex = index;
          state.strategyApplied = false;
          render();
        });
        dom.decisionList.appendChild(card);
      });
    };

    const renderSeriesList = () => {
      dom.seriesList.innerHTML = "";
      state.seriesOptions.forEach((series) => {
        const card = document.createElement("div");
        card.className = "card";
        if (state.activeSeriesId === series.id) {
          card.classList.add("active");
        }
        card.innerHTML = `
          <h4>${series.opponent}</h4>
          <div class="tag-row">
            <span class="tag">Rating ${series.rating}</span>
            <span class="tag">Payout $${series.payout}</span>
            <span class="tag">Risk ${series.risk}%</span>
          </div>
        `;
        card.addEventListener("click", () => {
          state.activeSeriesId = series.id;
          state.strategyIndex = null;
          state.strategyApplied = false;
          render();
        });
        dom.seriesList.appendChild(card);
      });
    };

    const renderMatchup = () => {
      const series = activeSeries();
      dom.matchupCard.innerHTML = "";
      if (!series) {
        dom.matchupCard.innerHTML = "<p class=\"subtitle\">Select an upcoming series to see the matchup details.</p>";
        return;
      }
      const team = teams.find((entry) => entry.abbr === state.team);
      dom.matchupCard.innerHTML = `
        <h2>${team.name} vs ${series.opponent}</h2>
        <div class="scoreboard">
          <div class="score"><small>Series Record</small><strong>${series.wins}-${series.losses}</strong></div>
          <div class="score"><small>Games</small><strong>${series.wins + series.losses}/${series.games}</strong></div>
          <div class="score"><small>Opponent Rating</small><strong>${series.rating}</strong></div>
        </div>
        <div class="tag-row">
          <span class="tag">Momentum Swing +${series.momentumSwing}</span>
          <span class="tag">Series Risk ${series.risk}%</span>
        </div>
      `;
    };

    const renderRoster = () => {
      dom.rosterList.innerHTML = "";
      state.roster.forEach((player) => {
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <h4>${player.name} Â· ${player.role}</h4>
          <small>BAT ${player.bat} | POW ${player.pow} | PIT ${player.pit} | DEF ${player.def} | SPD ${player.spd}</small>
          <div class="bar"><span style="width:${player.bat}%"></span></div>
        `;
        dom.rosterList.appendChild(card);
      });
    };

    const renderLog = () => {
      dom.log.innerHTML = "";
      state.log.forEach((entry) => {
        const row = document.createElement("div");
        row.className = `log-entry ${entry.tone}`;
        row.textContent = entry.message;
        dom.log.appendChild(row);
      });
    };

    const renderButtons = () => {
      dom.playBtn.disabled = !activeSeries() || state.series > 12;
      dom.scoutBtn.disabled = state.series > 12;
      dom.restBtn.disabled = state.series > 12;
      dom.boostBtn.disabled = state.series > 12;
      dom.trainingBtn.disabled = state.series > 12;
      dom.pitchingBtn.disabled = state.series > 12;
    };

    const render = () => {
      renderHeader();
      renderStats();
      renderDecisions();
      renderSeriesList();
      renderMatchup();
      renderRoster();
      renderLog();
      renderButtons();
    };

    const populateTeams = () => {
      dom.teamSelect.innerHTML = "";
      teams.forEach((team) => {
        const option = document.createElement("option");
        option.value = team.abbr;
        option.textContent = team.name;
        dom.teamSelect.appendChild(option);
      });
    };

    dom.startBtn.addEventListener("click", () => {
      const teamAbbr = dom.teamSelect.value;
      state = createState(teamAbbr);
      dom.menu.style.display = "none";
      dom.game.style.display = "block";
      render();
      saveGame();
    });

    dom.continueBtn.addEventListener("click", () => {
      const loaded = loadGame();
      if (!loaded) return;
      state = loaded;
      dom.menu.style.display = "none";
      dom.game.style.display = "block";
      render();
    });

    dom.resetBtn.addEventListener("click", () => {
      localStorage.removeItem("mlbRogueLeague");
      dom.continueBtn.disabled = true;
    });

    dom.scoutBtn.addEventListener("click", () => {
      refreshSeries();
      render();
      saveGame();
    });

    dom.playBtn.addEventListener("click", () => {
      applyStrategy();
      simulateGame();
      render();
      saveGame();
    });

    dom.restBtn.addEventListener("click", () => {
      restDay();
      render();
      saveGame();
    });

    dom.boostBtn.addEventListener("click", () => {
      clubhouseMeeting();
      render();
      saveGame();
    });

    dom.trainingBtn.addEventListener("click", () => {
      runTraining("hitting");
      render();
      saveGame();
    });

    dom.pitchingBtn.addEventListener("click", () => {
      runTraining("pitching");
      render();
      saveGame();
    });

    dom.saveBtn.addEventListener("click", () => {
      saveGame();
      dom.game.style.display = "none";
      dom.menu.style.display = "grid";
    });

    populateTeams();

    const saved = loadGame();
    dom.continueBtn.disabled = !saved;
  </script>
</body>
</html>
