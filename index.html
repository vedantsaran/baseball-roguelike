<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Baseball Roguelike</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #2c5f2d 0%, #4a8c4a 100%);
            min-height: 100vh;
            color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .game-container {
            max-width: 1200px;
            width: 100%;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .screen {
            display: none;
        }

        .screen.active {
            display: block;
        }

        .title {
            text-align: center;
            font-size: 2.5em;
            color: #ffeb3b;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .field {
            width: 400px;
            height: 400px;
            border: 3px solid #8bc34a;
            border-radius: 50%;
            position: relative;
            margin: 20px auto;
            background: radial-gradient(circle, #4caf50 0%, #2e7d32 100%);
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.3);
        }

        .base {
            width: 12px;
            height: 12px;
            background: #fff;
            position: absolute;
            border-radius: 2px;
            transform: rotate(45deg);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .base.first { top: 50%; right: 20px; }
        .base.second { top: 20px; left: 50%; }
        .base.third { top: 50%; left: 20px; }
        .base.home { bottom: 20px; left: 50%; background: #ffeb3b; }

        .ball {
            width: 8px;
            height: 8px;
            background: #fff;
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }

        .btn {
            padding: 10px 20px;
            background: #ff5722;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn:hover {
            background: #e64a19;
            transform: translateY(-2px);
        }

        .btn:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .stat-card h3 {
            color: #ffeb3b;
            margin-bottom: 10px;
        }

        .roster {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }

        .player-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 5px;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .player-card:hover {
            border-color: #ffeb3b;
        }

        .player-card.selected {
            border-color: #4caf50;
            background: rgba(76, 175, 80, 0.2);
        }

        .player-card.injured {
            border-color: #f44336;
            background: rgba(244, 67, 54, 0.2);
        }

        .log {
            background: rgba(0, 0, 0, 0.5);
            padding: 15px;
            border-radius: 5px;
            height: 200px;
            overflow-y: auto;
            margin: 20px 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-left: 3px solid #ffeb3b;
            padding-left: 10px;
        }

        .log-entry.hit {
            border-left-color: #4caf50;
        }

        .log-entry.out {
            border-left-color: #f44336;
        }

        .scoreboard {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .score-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 5px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .score-item h4 {
            color: #ffeb3b;
            margin-bottom: 5px;
        }

        .menu {
            text-align: center;
            padding: 40px;
        }

        .menu-btn {
            display: block;
            width: 200px;
            margin: 10px auto;
            padding: 15px;
            background: #2196f3;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .menu-btn:hover {
            background: #1976d2;
            transform: translateY(-2px);
        }

        .season-info {
            text-align: center;
            margin: 20px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4caf50, #8bc34a);
            transition: width 0.3s ease;
        }

        .stadium-info {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
        }

        .weather {
            display: inline-block;
            padding: 5px 10px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            margin: 0 5px;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- Main Menu -->
        <div class="screen active" id="menu">
            <div class="menu">
                <h1 class="title">‚öæ Baseball Roguelike</h1>
                <p>Manage your team through procedurally generated seasons!</p>
                <button class="menu-btn" onclick="newGame()">New Season</button>
                <button class="menu-btn" onclick="loadGame()" id="loadBtn" style="display: none;">Continue</button>
                <button class="menu-btn" onclick="showStats()">Career Stats</button>
            </div>
        </div>

        <!-- Game Screen -->
        <div class="screen" id="game">
            <div class="season-info">
                <h2>Season <span id="seasonNum">1</span> - Game <span id="gameNum">1</span></h2>
                <div class="progress-bar">
                    <div class="progress-fill" id="seasonProgress"></div>
                </div>
                <p>Wins: <span id="wins">0</span> | Losses: <span id="losses">0</span></p>
            </div>

            <div class="stadium-info">
                <h3 id="stadiumName">Generic Stadium</h3>
                <p id="stadiumQuirk">No special features</p>
                <div>
                    <span class="weather" id="weather">‚òÄÔ∏è Clear</span>
                    <span class="weather" id="windSpeed">üå¨Ô∏è Calm</span>
                </div>
            </div>

            <div class="scoreboard">
                <div class="score-item">
                    <h4>Inning</h4>
                    <div id="inning">1</div>
                </div>
                <div class="score-item">
                    <h4>Score</h4>
                    <div>You: <span id="playerScore">0</span></div>
                    <div>CPU: <span id="cpuScore">0</span></div>
                </div>
                <div class="score-item">
                    <h4>Outs</h4>
                    <div id="outs">0</div>
                </div>
            </div>

            <div class="field">
                <div class="base first"></div>
                <div class="base second"></div>
                <div class="base third"></div>
                <div class="base home"></div>
                <div class="ball" id="ball"></div>
            </div>

            <div class="controls">
                <button class="btn" id="swingBtn" onclick="swing()">Swing!</button>
                <button class="btn" id="pitchBtn" onclick="pitch()">Pitch</button>
                <button class="btn" onclick="showTeam()">Team</button>
                <button class="btn" onclick="endGame()">End Game</button>
            </div>

            <div class="log" id="gameLog"></div>
        </div>

        <!-- Team Management -->
        <div class="screen" id="team">
            <h2>Team Management</h2>
            <div class="stats">
                <div class="stat-card">
                    <h3>Team Stats</h3>
                    <p>Budget: $<span id="budget">50000</span></p>
                    <p>Morale: <span id="morale">75</span>%</p>
                    <p>Injuries: <span id="injuries">0</span></p>
                </div>
                <div class="stat-card">
                    <h3>Current Lineup</h3>
                    <div id="lineup"></div>
                </div>
            </div>
            <div class="roster" id="roster"></div>
            <div class="controls">
                <button class="btn" onclick="healPlayer()">Heal Player ($5000)</button>
                <button class="btn" onclick="trainPlayer()">Train Player ($2000)</button>
                <button class="btn" onclick="backToGame()">Back to Game</button>
            </div>
        </div>

        <!-- Career Stats -->
        <div class="screen" id="stats">
            <h2>Career Statistics</h2>
            <div class="stats">
                <div class="stat-card">
                    <h3>Career Overview</h3>
                    <p>Total Seasons: <span id="totalSeasons">0</span></p>
                    <p>Total Wins: <span id="totalWins">0</span></p>
                    <p>Total Losses: <span id="totalLosses">0</span></p>
                    <p>Championships: <span id="championships">0</span></p>
                </div>
                <div class="stat-card">
                    <h3>Best Season</h3>
                    <p>Best Record: <span id="bestRecord">0-0</span></p>
                    <p>Longest Win Streak: <span id="longestStreak">0</span></p>
                    <p>Most Runs in Game: <span id="mostRuns">0</span></p>
                </div>
            </div>
            <div class="controls">
                <button class="btn" onclick="resetStats()">Reset Career</button>
                <button class="btn" onclick="showMenu()">Back to Menu</button>
            </div>
        </div>
    </div>

    <script>
        // Game State
        let gameState = {
            season: 1,
            game: 1,
            wins: 0,
            losses: 0,
            inning: 1,
            playerScore: 0,
            cpuScore: 0,
            outs: 0,
            isPlayerTurn: true,
            budget: 50000,
            morale: 75,
            currentStadium: null,
            weather: 'clear',
            windSpeed: 'calm'
        };

        // Stadium and Weather Types
        const stadiums = [
            { name: "Fenway Park", quirk: "Short left field wall boosts home runs", leftField: 310, rightField: 302 },
            { name: "Coors Field", quirk: "Thin air increases ball carry", elevation: 5280, hitter: 1.2 },
            { name: "Minute Maid Park", quirk: "Tal wall in left center", leftCenter: 436, unique: "hill" },
            { name: "Yankee Stadium", quirk: "Short right field porch", rightField: 314, hr: 1.1 },
            { name: "Petco Park", quirk: "Pitcher-friendly dimensions", pitcher: 1.1, hitter: 0.9 }
        ];

        const weatherTypes = [
            { name: "‚òÄÔ∏è Clear", effect: 1.0 },
            { name: "üåßÔ∏è Rainy", effect: 0.8 },
            { name: "‚ùÑÔ∏è Cold", effect: 0.9 },
            { name: "üå´Ô∏è Foggy", effect: 0.85 },
            { name: "üå™Ô∏è Windy", effect: 1.1 }
        ];

        const windSpeeds = [
            { name: "üå¨Ô∏è Calm", effect: 1.0 },
            { name: "üå¨Ô∏è Light", effect: 1.05 },
            { name: "üå¨Ô∏è Strong", effect: 1.15 },
            { name: "üå¨Ô∏è Gale", effect: 1.25 }
        ];

        // Player Generation
        const playerNames = [
            "Mike Johnson", "Carlos Rodriguez", "Jake Wilson", "Tony Martinez", "Sam Anderson",
            "Alex Thompson", "Ryan Davis", "Matt Garcia", "Chris Miller", "Dave Brown",
            "Nick Jones", "Tyler Smith", "Josh Williams", "Luke Taylor", "Ben Clark"
        ];

        const positions = ["Pitcher", "Catcher", "1st Base", "2nd Base", "3rd Base", "Shortstop", "Left Field", "Center Field", "Right Field"];

        let team = [];
        let selectedPlayer = null;

        // Initialize game
        function init() {
            loadGameData();
            generateTeam();
            updateDisplay();
            
            if (hasGameData()) {
                document.getElementById('loadBtn').style.display = 'block';
            }
        }

        // Random number generator with seed support
        function random(min = 0, max = 1) {
            return Math.random() * (max - min) + min;
        }

        function randomInt(min, max) {
            return Math.floor(random(min, max + 1));
        }

        function randomChoice(array) {
            return array[randomInt(0, array.length - 1)];
        }

        // Generate a random team
        function generateTeam() {
            team = [];
            for (let i = 0; i < 15; i++) {
                team.push({
                    name: randomChoice(playerNames),
                    position: randomChoice(positions),
                    batting: randomInt(50, 95),
                    pitching: randomInt(30, 85),
                    fielding: randomInt(40, 90),
                    speed: randomInt(35, 85),
                    fatigue: randomInt(10, 30),
                    injured: false,
                    games: 0,
                    hits: 0,
                    runs: 0
                });
            }
        }

        // Stadium and weather generation
        function generateStadium() {
            gameState.currentStadium = randomChoice(stadiums);
            gameState.weather = randomChoice(weatherTypes);
            gameState.windSpeed = randomChoice(windSpeeds);
            
            document.getElementById('stadiumName').textContent = gameState.currentStadium.name;
            document.getElementById('stadiumQuirk').textContent = gameState.currentStadium.quirk;
            document.getElementById('weather').textContent = gameState.weather.name;
            document.getElementById('windSpeed').textContent = gameState.windSpeed.name;
        }

        // Game mechanics
        function swing() {
            if (!gameState.isPlayerTurn) return;
            
            const batter = getBestBatter();
            const pitcher = getRandomCPUPitcher();
            
            // Calculate hit probability
            let hitChance = (batter.batting - pitcher.pitching) / 100;
            
            // Apply stadium effects
            if (gameState.currentStadium.hitter) {
                hitChance *= gameState.currentStadium.hitter;
            }
            
            // Apply weather effects
            hitChance *= gameState.weather.effect;
            
            // Cap hit chance between 0.1 and 0.8
            hitChance = Math.max(0.1, Math.min(0.8, hitChance));
            
            const result = random();
            
            if (result < hitChance) {
                // It's a hit!
                const hitType = random();
                if (hitType < 0.05) {
                    // Home run
                    gameState.playerScore += 1;
                    addLog("üí• HOME RUN! You score!", "hit");
                    animateBall();
                } else if (hitType < 0.2) {
                    // Double/Triple
                    addLog("üî• Extra base hit!", "hit");
                    if (random() < 0.3) gameState.playerScore += 1;
                } else {
                    // Single
                    addLog("‚úÖ Base hit!", "hit");
                    if (random() < 0.25) gameState.playerScore += 1;
                }
                
                batter.hits++;
                batter.games++;
                
                // Increase fatigue
                batter.fatigue += randomInt(1, 3);
                
                // Switch to CPU turn
                gameState.isPlayerTurn = false;
                updateButtons();
            } else {
                // It's an out
                gameState.outs++;
                addLog("‚ùå Out! " + getOutType(), "out");
                
                if (gameState.outs >= 3) {
                    endInning();
                }
            }
            
            updateDisplay();
        }

        function pitch() {
            if (gameState.isPlayerTurn) return;
            
            const pitcher = getBestPitcher();
            const batter = getRandomCPUBatter();
            
            // Calculate hit probability for CPU
            let hitChance = (batter.batting - pitcher.pitching) / 100;
            
            // Apply stadium effects
            if (gameState.currentStadium.pitcher) {
                hitChance /= gameState.currentStadium.pitcher;
            }
            
            // Apply weather effects
            hitChance *= gameState.weather.effect;
            
            // Cap hit chance
            hitChance = Math.max(0.1, Math.min(0.7, hitChance));
            
            const result = random();
            
            if (result < hitChance) {
                // CPU hit
                const hitType = random();
                if (hitType < 0.03) {
                    // CPU home run
                    gameState.cpuScore += 1;
                    addLog("üí• CPU hits a home run!", "hit");
                } else if (hitType < 0.15) {
                    // CPU extra base hit
                    addLog("üî• CPU gets an extra base hit!", "hit");
                    if (random() < 0.3) gameState.cpuScore += 1;
                } else {
                    // CPU single
                    addLog("‚úÖ CPU gets a base hit!", "hit");
                    if (random() < 0.2) gameState.cpuScore += 1;
                }
            } else {
                // CPU out
                gameState.outs++;
                addLog("‚ùå CPU out! " + getOutType(), "out");
                
                if (gameState.outs >= 3) {
                    endInning();
                }
            }
            
            // Increase pitcher fatigue
            pitcher.fatigue += randomInt(1, 2);
            
            // Switch to player turn
            gameState.isPlayerTurn = true;
            updateButtons();
            updateDisplay();
        }

        function getOutType() {
            const types = ["Strikeout", "Groundout", "Flyout", "Popup", "Line drive caught"];
            return randomChoice(types);
        }

        function endInning() {
            gameState.inning++;
            gameState.outs = 0;
            gameState.isPlayerTurn = true;
            
            addLog(`--- End of Inning ${gameState.inning - 1} ---`);
            
            // Check if game is over
            if (gameState.inning > 9) {
                endGame();
                return;
            }
            
            // Random events
            if (random() < 0.1) {
                triggerRandomEvent();
            }
            
            updateButtons();
            updateDisplay();
        }

        function triggerRandomEvent() {
            const events = [
                { text: "‚ö° Lightning delay! Players are energized!", effect: () => team.forEach(p => p.fatigue = Math.max(0, p.fatigue - 5)) },
                { text: "ü§ï Player injury during warmup!", effect: () => { const p = randomChoice(team.filter(p => !p.injured)); if (p) p.injured = true; } },
                { text: "üéØ Pitcher finds his rhythm!", effect: () => { const p = getBestPitcher(); p.pitching += 5; } },
                { text: "üî• Batter is seeing the ball well!", effect: () => { const p = getBestBatter(); p.batting += 5; } },
                { text: "üí® Strong wind picks up!", effect: () => gameState.windSpeed = randomChoice(windSpeeds) }
            ];
            
            const event = randomChoice(events);
            addLog(event.text);
            event.effect();
        }

        function getBestBatter() {
            return team.filter(p => !p.injured && p.fatigue < 80)
                      .sort((a, b) => b.batting - a.batting)[0] || team[0];
        }

        function getBestPitcher() {
            return team.filter(p => !p.injured && p.fatigue < 90)
                      .sort((a, b) => b.pitching - a.pitching)[0] || team[0];
        }

        function getRandomCPUBatter() {
            return {
                batting: randomInt(40, 80),
                name: "CPU Batter"
            };
        }

        function getRandomCPUPitcher() {
            return {
                pitching: randomInt(45, 75),
                name: "CPU Pitcher"
            };
        }

        function animateBall() {
            const ball = document.getElementById('ball');
            ball.style.transform = 'translate(-50%, -50%) scale(1.5)';
            setTimeout(() => {
                ball.style.transform = 'translate(-50%, -50%) scale(1)';
            }, 300);
        }

        function addLog(message, type = "") {
            const log = document.getElementById('gameLog');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = message;
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        }

        function updateDisplay() {
            document.getElementById('seasonNum').textContent = gameState.season;
            document.getElementById('gameNum').textContent = gameState.game;
            document.getElementById('wins').textContent = gameState.wins;
            document.getElementById('losses').textContent = gameState.losses;
            document.getElementById('inning').textContent = gameState.inning;
            document.getElementById('playerScore').textContent = gameState.playerScore;
            document.getElementById('cpuScore').textContent = gameState.cpuScore;
            document.getElementById('outs').textContent = gameState.outs;
            document.getElementById('budget').textContent = gameState.budget;
            document.getElementById('morale').textContent = gameState.morale;
            document.getElementById('injuries').textContent = team.filter(p => p.injured).length;
            
            const progress = (gameState.game / 20) * 100;
            document.getElementById('seasonProgress').style.width = progress + '%';
            
            updateRoster();
            updateButtons();
        }

        function updateButtons() {
            const swingBtn = document.getElementById('swingBtn');
            const pitchBtn = document.getElementById('pitchBtn');
            
            swingBtn.disabled = !gameState.isPlayerTurn;
            pitchBtn.disabled = gameState.isPlayerTurn;
        }

        function updateRoster() {
            const roster = document.getElementById('roster');
            roster.innerHTML = '';
            
            team.forEach((player, index) => {
                const card = document.createElement('div');
                card.className = 'player-card';
                if (player.injured) card.classList.add('injured');
                if (selectedPlayer === index) card.classList.add('selected');
                
                card.innerHTML = `
                    <h4>${player.name}</h4>
                    <p>${player.position}</p>
                    <p>BAT: ${player.batting} | PITCH: ${player.pitching}</p>
                    <p>FIELD: ${player.fielding} | SPEED: ${player.speed}</p>
                    <p>Fatigue: ${player.fatigue}% ${player.injured ? '(INJURED)' : ''}</p>
                    <p>Games: ${player.games} | Hits: ${player.hits}</p>
                `;
                
                card.onclick = () => selectPlayer(index);
                roster.appendChild(card);
            });
        }

        function selectPlayer(index) {
            selectedPlayer = index;
            updateRoster();
        }

        function healPlayer() {
            if (selectedPlayer === null) {
                alert("Select a player first!");
                return;
            }
            
            if (gameState.budget < 5000) {
                alert("Not enough budget!");
                return;
            }
            
            const player = team[selectedPlayer];
            if (!player.injured) {
                alert("Player is not injured!");
                return;
            }
            
            player.injured = false;
            gameState.budget -= 5000;
            addLog(`${player.name} has been healed!`);
            updateDisplay();
        }

        function trainPlayer() {
            if (selectedPlayer === null) {
                alert("Select a player first!");
                return;
            }
            
            if (gameState.budget < 2000) {
                alert("Not enough budget!");
                return;
            }
            
            const player = team[selectedPlayer];
            const stat = randomChoice(['batting', 'pitching', 'fielding', 'speed']);
            player[stat] += randomInt(1, 5);
            player.fatigue = Math.max(0, player.fatigue - 10);
            
            gameState.budget -= 2000;
            addLog(`${player.name} improved their ${stat}!`);
            updateDisplay();
        }

        function endGame() {
            const won = gameState.playerScore > gameState.cpuScore;
            
            if (won) {
                gameState.wins++;
                gameState.budget += 10000;
                addLog("üèÜ GAME WON! +$10,000 budget!");
            } else {
                gameState.losses++;
                gameState.budget += 2000;
                addLog("üí∏ Game lost. +$2,000 budget.");
            }
            
            // Update team fatigue and potential injuries
            team.forEach(player => {
                player.fatigue += randomInt(5, 15);
                if (player.fatigue > 100) {
                    player.fatigue = 100;
                    if (random() < 0.1) {
                        player.injured = true;
                        addLog(`${player.name} is injured from exhaustion!`);
                    }
                }
            });
            
            gameState.game++;
            
            // Check if season is over
            if (gameState.game > 20) {
                endSeason();
            } else {
                // Prepare for next game
                gameState.inning = 1;
                gameState.playerScore = 0;
                gameState.cpuScore = 0;
                gameState.outs = 0;
                gameState.isPlayerTurn = true;
                
                generateStadium();
                updateDisplay();
                saveGameData();
            }
        }

        function endSeason() {
            const winRate = gameState.wins / (gameState.wins + gameState.losses);
            
            if (winRate >= 0.6) {
                addLog("üèÜ CHAMPIONSHIP SEASON! Starting new season with bonuses!");
                gameState.budget += 25000;
                updateCareerStats('championships');
            } else if (winRate >= 0.5) {
                addLog("‚úÖ Successful season! Starting new season.");
                gameState.budget += 15000;
            } else {
                addLog("üìâ Tough season. Better luck next time!");
                gameState.budget += 5000;
            }
            
            // Update career stats
            updateCareerStats('seasons');
            updateCareerStats('totalWins', gameState.wins);
            updateCareerStats('totalLosses', gameState.losses);
            
            // Reset for new season
            gameState.season++;
            gameState.game = 1;
            gameState.wins = 0;
            gameState.losses = 0;
            gameState.inning = 1;
            gameState.playerScore = 0;
            gameState.cpuScore = 0;
            gameState.outs = 0;
            gameState.isPlayerTurn = true;
            
            // Age players and generate new ones
            team.forEach(player => {
                player.fatigue = randomInt(0, 20);
                player.injured = false;
                // Small chance of stat decline due to age
                if (random() < 0.1) {
                    const stat = randomChoice(['batting', 'pitching', 'fielding', 'speed']);
                    player[stat] = Math.max(20, player[stat] - randomInt(1, 5));
                }
            });
            
            // Add some new players
            for (let i = 0; i < 3; i++) {
                if (team.length < 18) {
                    team.push({
                        name: randomChoice(playerNames),
                        position: randomChoice(positions),
                        batting: randomInt(45, 85),
                        pitching: randomInt(30, 75),
                        fielding: randomInt(40, 85),
                        speed: randomInt(35, 80),
                        fatigue: randomInt(0, 20),
                        injured: false,
                        games: 0,
                        hits: 0,
                        runs: 0
                    });
                }
            }
            
            generateStadium();
            updateDisplay();
            saveGameData();
        }

        // Screen management
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        function showMenu() {
            showScreen('menu');
        }

        function showTeam() {
            showScreen('team');
            updateDisplay();
        }

        function backToGame() {
            showScreen('game');
        }

        function showStats() {
            showScreen('stats');
            loadCareerStats();
        }

        function newGame() {
            // Reset game state
            gameState = {
                season: 1,
                game: 1,
                wins: 0,
                losses: 0,
                inning: 1,
                playerScore: 0,
                cpuScore: 0,
                outs: 0,
                isPlayerTurn: true,
                budget: 50000,
                morale: 75,
                currentStadium: null,
                weather: 'clear',
                windSpeed: 'calm'
            };
            
            generateTeam();
            generateStadium();
            document.getElementById('gameLog').innerHTML = '';
            addLog("üéÆ New season started! Play ball!");
            
            showScreen('game');
            updateDisplay();
            saveGameData();
        }

        function loadGame() {
            const saved = localStorage.getItem('baseballRoguelike');
            if (saved) {
                const data = JSON.parse(saved);
                gameState = data.gameState;
                team = data.team;
                
                generateStadium();
                showScreen('game');
                updateDisplay();
                addLog("üìÅ Game loaded successfully!");
            }
        }

        function saveGameData() {
            const data = {
                gameState: gameState,
                team: team
            };
            localStorage.setItem('baseballRoguelike', JSON.stringify(data));
        }

        function loadGameData() {
            const saved = localStorage.getItem('baseballRoguelike');
            if (saved) {
                const data = JSON.parse(saved);
                gameState = data.gameState;
                team = data.team;
                return true;
            }
            return false;
        }

        function hasGameData() {
            return localStorage.getItem('baseballRoguelike') !== null;
        }

        function updateCareerStats(stat, value = 1) {
            const current = parseInt(localStorage.getItem('career_' + stat) || '0');
            localStorage.setItem('career_' + stat, (current + value).toString());
        }

        function loadCareerStats() {
            const stats = ['totalSeasons', 'totalWins', 'totalLosses', 'championships'];
            stats.forEach(stat => {
                const value = localStorage.getItem('career_' + stat) || '0';
                document.getElementById(stat).textContent = value;
            });
            
            // Calculate best record
            const wins = parseInt(localStorage.getItem('career_totalWins') || '0');
            const losses = parseInt(localStorage.getItem('career_totalLosses') || '0');
            document.getElementById('bestRecord').textContent = `${wins}-${losses}`;
            
            // Mock additional stats
            document.getElementById('longestStreak').textContent = localStorage.getItem('career_streak') || '0';
            document.getElementById('mostRuns').textContent = localStorage.getItem('career_mostRuns') || '0';
        }

        function resetStats() {
            if (confirm('Are you sure you want to reset all career statistics?')) {
                const keys = Object.keys(localStorage).filter(key => key.startsWith('career_'));
                keys.forEach(key => localStorage.removeItem(key));
                localStorage.removeItem('baseballRoguelike');
                loadCareerStats();
                document.getElementById('loadBtn').style.display = 'none';
            }
        }

        // Initialize game when page loads
        window.onload = init;
    </script>
</body>
</html> 